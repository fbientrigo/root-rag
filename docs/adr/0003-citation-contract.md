# ADR 0003: Citation contract and fail-closed answering

## Status
Accepted

## Context
The project is explicitly intended to reduce hallucination when querying ROOT code and docs.
Users need to see:
- where a claim came from
- which file and lines support it
- whether the support is strong or weak

A conventional chatbot answer without evidence does not satisfy the project goal.

## Decision
Adopt a strict citation contract and fail-closed answering model.

Rules:
- every technical claim in an answer must be backed by at least one evidence item
- every evidence item must include file path, start line, end line, and version metadata
- if evidence is partial, the response must say so
- if evidence is missing, the system must not answer as if it knows
- summaries generated by an LLM must not modify or invent citations
- line ranges reference the original source file, not transformed chunk-local offsets

## Consequences

### Positive
- reduces hallucination
- makes debugging and user trust easier
- aligns with scientific and engineering workflows
- enables copy-pasteable references into issues and notes

### Negative
- answers may be shorter or more conservative
- some user queries will end in explicit "insufficient evidence"
- implementation must maintain provenance carefully

### Operational
- tests must check citation presence
- CLI and API must expose warnings when evidence is weak
- future GPT integration must preserve this contract

## Alternatives discarded

### Free-form summarization with optional citations
Rejected because citations would become decorative rather than contractual.

### Citations by chunk id only
Rejected because users need file-and-line provenance, not opaque ids.

### Returning only URLs to docs
Rejected because source code questions require file-and-line evidence.

### Best-effort answering without warnings
Rejected because it hides uncertainty and undermines the purpose of the system.
